<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°äºŒæ•¸å­¸ï¼š4ä½æ•¸å¤§æŒ‘æˆ°</title>
    <style>
        :root {
            --wood: #8b4513;
            --leaf: #2e7d32;
            --sky: #e0f2f1;
            --paper: #fff9c4;
        }
        body {
            background-color: var(--sky);
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        .game-container {
            background-color: white;
            border: 8px solid var(--wood);
            border-radius: 30px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
        }
        h1 { color: var(--leaf); margin-top: 0; font-size: 28px; }
        .mission-box {
            background-color: var(--paper);
            border: 3px dashed var(--wood);
            padding: 15px;
            border-radius: 15px;
            font-size: 22px;
            font-weight: bold;
            color: #d84315;
            margin-bottom: 25px;
        }
        .section-title { font-size: 16px; color: #666; margin-bottom: 10px; }
        .card-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            min-height: 100px;
        }
        .num-card {
            width: 70px;
            height: 100px;
            background: linear-gradient(135deg, #ffeb3b, #fbc02d);
            border: 3px solid var(--wood);
            border-radius: 12px;
            font-size: 40px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 5px 0 var(--wood);
            transition: 0.1s;
            user-select: none;
        }
        .num-card:active { transform: translateY(4px); box-shadow: none; }
        .num-card.hidden { opacity: 0.1; cursor: default; transform: scale(0.9); }
        
        .slot {
            width: 70px;
            height: 100px;
            border: 4px solid #bdbdbd;
            border-radius: 12px;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .slot.filled { border-color: var(--leaf); background-color: #e8f5e9; }

        .button-group { display: flex; gap: 15px; justify-content: center; margin-top: 10px; }
        .btn {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            transition: 0.1s;
        }
        .btn-check { background-color: #43a047; }
        .btn-next { background-color: #1e88e5; }
        .btn-reset { background-color: #e53935; }
        .btn:active { transform: translateY(3px); box-shadow: none; }

        #feedback {
            margin-top: 25px;
            font-size: 20px;
            font-weight: bold;
            min-height: 1.5em;
            padding: 10px;
            border-radius: 10px;
        }
        .win { color: #2e7d32; background-color: #c8e6c9; }
        .wrong { color: #c62828; background-color: #ffcdd2; }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>ğŸŒ³ æ£®æ—æ•¸å­¸å°è€å¸« ğŸ”¢</h1>
        
        <div id="mission" class="mission-box">æ­£åœ¨æº–å‚™é¡Œç›®...</div>

        <div class="section-title">ä½ çš„å¡ç‰‡ (é»æ“Šæ•¸å­—)ï¼š</div>
        <div class="card-row" id="pool"></div>

        <div class="section-title">æŠŠæ•¸å­—æ’åœ¨é€™è£¡ï¼š</div>
        <div class="card-row">
            <div class="slot" id="slot0" onclick="popNum(0)"></div>
            <div class="slot" id="slot1" onclick="popNum(1)"></div>
            <div class="slot" id="slot2" onclick="popNum(2)"></div>
            <div class="slot" id="slot3" onclick="popNum(3)"></div>
        </div>

        <div class="button-group">
            <button class="btn btn-reset" onclick="resetAnswer()">é‡æ’ ğŸ”„</button>
            <button class="btn btn-check" onclick="checkAnswer()">æª¢æŸ¥ç­”æ¡ˆ âœ”ï¸</button>
            <button class="btn btn-next" onclick="initGame()">ä¸‹ä¸€é¡Œ â”</button>
        </div>

        <div id="feedback"></div>
    </div>

<script>
    let cards = [];
    let selectedIndices = [];
    let missionType = "";

    function initGame() {
        const types = ["æœ€å¤§4ä½å¥‡æ•¸", "æœ€å°4ä½å¥‡æ•¸", "æœ€å¤§4ä½å¶æ•¸", "æœ€å°4ä½å¶æ•¸"];
        missionType = types[Math.floor(Math.random() * types.length)];
        document.getElementById('mission').innerText = "ä»»å‹™ï¼š" + missionType;
        
        // ç¢ºä¿é¡Œç›®ä¸€å®šæœ‰è§£ (å¿…é ˆæœ‰å¥‡æ•¸/å¶æ•¸ï¼Œä¸”æœ‰é0æ•¸å­—)
        let valid = false;
        while (!valid) {
            cards = Array.from({length: 4}, () => Math.floor(Math.random() * 10));
            let hasOdd = cards.some(n => n % 2 !== 0);
            let hasEven = cards.some(n => n % 2 === 0);
            let hasNonZero = cards.some(n => n !== 0);
            
            if (hasNonZero && (missionType.includes("å¥‡æ•¸") ? hasOdd : hasEven)) {
                // æª¢æŸ¥æ˜¯å¦çœŸçš„èƒ½æ’æˆ4ä½æ•¸ (å¦‚æœåªæœ‰ä¸€å€‹é0ï¼Œè€Œå®ƒåˆæ˜¯å”¯ä¸€çš„å¥‡æ•¸ä¸”è¢«è¦æ±‚æ’åœ¨æœ«ä½)
                let best = calculateBest();
                if (best !== null) valid = true;
            }
        }

        selectedIndices = [];
        document.getElementById('feedback').innerText = "";
        document.getElementById('feedback').className = "";
        render();
    }

    function render() {
        const pool = document.getElementById('pool');
        pool.innerHTML = "";
        cards.forEach((num, index) => {
            let div = document.createElement('div');
            div.className = "num-card" + (selectedIndices.includes(index) ? " hidden" : "");
            div.innerText = num;
            div.onclick = () => pushNum(index);
            pool.appendChild(div);
        });

        for (let i = 0; i < 4; i++) {
            const slot = document.getElementById('slot' + i);
            if (selectedIndices[i] !== undefined) {
                slot.innerText = cards[selectedIndices[i]];
                slot.classList.add('filled');
            } else {
                slot.innerText = "";
                slot.classList.remove('filled');
            }
        }
    }

    function pushNum(idx) {
        if (selectedIndices.length < 4 && !selectedIndices.includes(idx)) {
            selectedIndices.push(idx);
            render();
        }
    }

    function popNum(slotIdx) {
        if (selectedIndices[slotIdx] !== undefined) {
            selectedIndices.splice(slotIdx, 1);
            render();
        }
    }

    function resetAnswer() {
        selectedIndices = [];
        render();
    }

    function checkAnswer() {
        const fb = document.getElementById('feedback');
        if (selectedIndices.length < 4) {
            fb.innerText = "è¦æŠŠ 4 å€‹æ ¼å­éƒ½å¡«æ»¿å–”ï¼";
            fb.className = "wrong";
            return;
        }

        let userDigits = selectedIndices.map(i => cards[i]);
        let userNum = parseInt(userDigits.join(''));

        // è¦å‰‡1: é¦–ä½ä¸èƒ½ç‚º0
        if (userDigits[0] === 0) {
            fb.innerText = "é¦–ä½ä¸èƒ½æ˜¯ 0 å‘€ï¼å°æœ‹å‹å†è©¦è©¦ã€‚";
            fb.className = "wrong";
            return;
        }

        // è¦å‰‡2: å¥‡å¶æª¢æŸ¥
        let isOdd = userDigits[3] % 2 !== 0;
        if (missionType.includes("å¥‡æ•¸") && !isOdd) {
            fb.innerText = "é€™ä¸æ˜¯å¥‡æ•¸ï¼ˆå°¾æ•¸è¦æ˜¯ 1, 3, 5, 7, 9ï¼‰";
            fb.className = "wrong";
            return;
        }
        if (missionType.includes("å¶æ•¸") && isOdd) {
            fb.innerText = "é€™ä¸æ˜¯å¶æ•¸ï¼ˆå°¾æ•¸è¦æ˜¯ 0, 2, 4, 6, 8ï¼‰";
            fb.className = "wrong";
            return;
        }

        // è¦å‰‡3: æœ€å¤§æœ€å°æª¢æŸ¥
        let bestNum = calculateBest();
        if (userNum === bestNum) {
            fb.innerText = "ğŸ‰ å¤ªæ£’äº†ï¼ä½ æ‰¾åˆ°äº†æ­£ç¢ºç­”æ¡ˆï¼";
            fb.className = "win";
        } else {
            fb.innerText = "ç¬¦åˆè¦å‰‡ï¼Œä½†é€™ä¸æ˜¯ã€Œ" + missionType.substring(0,2) + "ã€çš„å–”ï¼";
            fb.className = "wrong";
        }
    }

    function calculateBest() {
        let all = [];
        function permute(arr, m = []) {
            if (arr.length === 0) {
                if (m[0] !== 0) {
                    let last = m[3];
                    let isO = last % 2 !== 0;
                    if ((missionType.includes("å¥‡æ•¸") && isO) || (missionType.includes("å¶æ•¸") && !isO)) {
                        all.push(parseInt(m.join('')));
                    }
                }
            } else {
                for (let i = 0; i < arr.length; i++) {
                    let curr = [...arr];
                    let next = curr.splice(i, 1);
                    permute(curr, m.concat(next));
                }
            }
        }
        permute(cards);
        if (all.length === 0) return null;
        return missionType.includes("æœ€å¤§") ? Math.max(...all) : Math.min(...all);
    }

    // å•Ÿå‹•éŠæˆ²
    initGame();
</script>

</body>
</html>